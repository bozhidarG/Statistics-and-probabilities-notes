Още една задача със семплиране. 

Задача:
Взимам 36 ябълки от ферма произвела над 200 000 ябълки. Средното тегло на извадката е 112грама (с 40 грама стандартно отклонение).
Каква е вероятността всички 200 000 ябълки да тежат между 100 и 124 грама?

Какво знаем? 
Камбановидна графика (population distribution) със средно Mu и стандартно отклонение Сигма.
По-скоро какво не знаем.. 
Не знаем точният брой ябълки. Само знаем, че е голямо число.
Не знаем колко средно тежи ябълката в рамките на цялата реколта.
Не знаем и стандартното отклонение на ябълките в рамките на цялата реколта.

Sampling distribution:
За да намерим средното на популацията, правим семплиране на извадката ни от 36 ябълки, след което взимаме средното на средните от семплирането и така ще намерим приблизително колко е средното на цялата реколта.
Стандартното отклонение на популацията e приблизително стандартно отклонение на извадката/sqrt(36)
*36 е броят на извадката, с която разполагаме

Питат ни каква е вероятността средната тежест на ябълките да бъде между 100 и 124 грама.
т.е. вероятността средното на реколтата да е с до 12 грама различаващо се от средното на извадката.

Ако знаем тези неща, то можем да използваме z-table, за да изчислим вероятността.
Да намерим стандартното отклонение на популацията. Взимаме стан. октл. = 40 (имаме го по условие)
значи ст. отклонение на популацията е: 40/sqrt(36) = 6.67
Въпросът, на който трябва да си отговорим е:
На колко стандартни отклонения е 12, при стандартно отклонение 6.67? (12 e грамoвете, които можем да мърдаме от средното)
12/6,67 = 1.8. Проверяваме от z-score таблицата:
#Значи: Каква е вероятността средното на реколтата да бяга с 1.8 стандартни отклонения?
Таблица със z-scores: http://media.tumblr.com/tumblr_mb3781q8zL1r80ng4.png

Сега: каква е вероятността да сме между средното и 1.8.
z-score = 0.9641, но това е вероятността да сме под 1.8 ст. отклон. (включително от -безкрайност до -1.8)
значи вероятността е: 92.82 процента. (вадим от 1, два пъти остатъкът от 0.9641 до 1.)

---------Доверителни интервали---------
Построяването на доверителен интервал е статистически подход, който се прилага, когато не знаем средното на популацията или нейното стандартното отклонение, или и двете.

Чрез този подход може да предскажем параметрите за популацията (средно и стандартно отклонение), но с процент на увереност.

Пример за ситуация, когато се прилага този тип анализ е:

Питат 100 човека дали даден продукт им харесва (например някакъв душ-гел)
42 от 100 човека казват, че им харесва. 
Как би се изказал репорт по телевизията? Кой е най-правилният начин?
42% от населението предпочита даденият душ-гел
42% от населението предпочитат душ-гела при стандартнa грешка 9%
42% от населението предпочитат душ-гела при стандартна грешка 9%, като тази информация е 95% вярна.

Процентът на увереност в нашето предсказание е спрямо какъв интервал от камбанката сме обхванали.
P (-1 < z < 1 ) = 0.68
P (-2 < z < 2 ) = 0.95
P (-3 < z < 3 ) = 0.998
http://media.tumblr.com/tumblr_mb3781q8zL1r80ng4.png
NB: остатъкът делим на 2, за да е симетрично.

Тази оценка може да я направим чрез следните функции в R: 
prop.test, t.test, wilcox.test 

----Proportion test----
prop.test(42,100)
Тест на базата на процентно отношение.
За момента ни интересуват само последните 2 данни (доверителният интервал и средното на популацията)

        1-sample proportions test with continuity correction

data:  42 out of 100, null probability 0.5
X-squared = 2.25, df = 1, p-value = 0.1336
alternative hypothesis: true p is not equal to 0.5
95 percent confidence interval:
 0.3233236 0.5228954
sample estimates:
   p 
0.42 

Интерпретация на последните 2 данни:
С 95% увереност може да твърдим, че между 32 и 52 процента от популацията ще харесат душ-гела.
средно: 0.42 от общо 1.00 харесват душ гена (42%)

Задаване на конкретен доверителен интервал:
prop.test(42,100,conf.level=0.9)

----t.test----
Подобен тест като горният, но спрямо средното на извадката.
НБ! Този тест е адекватно приложим само за нормално разпределени данни.

x <- scan()
155 156 153 155 154 153 153 156 153 159
*данните са ръст на ескимоси
**всяка прилика на стойностите и интерпретацията на данните с реалността е чиста случайност.
t.test(x)

        One Sample t-test

data:  x
t = 251.32, df = 9, p-value < 2.2e-16
alternative hypothesis: true mean is not equal to 0
95 percent confidence interval:
 153.3076 156.0924
sample estimates:
mean of x 
    154.7 

Интерпретация на резултата:
с 95% увереност можем да твърдим, че цялата ескимоска популация е с ръст между 153 и 156 сантиметра.
Среден ръст на ескимос 154.7 
*Средното на извадката е достатъчно добро приближение на средното на популацията.

NB! Как проверяваме дали данните ни са нормално разпределени?
Отговор:
Следващия път

---wilcox.test---
Подобен тест като горните, но спрямо медианата на извадката.

Намиране на медианата.
x=c(110,12,2.5,98,1017,540,54,4.3,150,432)
wilcox.test(x,conf.int=TRUE)
wilcox.test(x,conf.int=TRUE, conf.level=0.9)
        
		Wilcoxon signed rank test

data:  x
V = 55, p-value = 0.001953
alternative hypothesis: true location is not equal to 0
95 percent confidence interval:
  33.0 514.5
sample estimates:
(pseudo)median 
           150 

С 95% увереност може да кажем, че данните са интервала [33, 514] 
Медиана на данните 150.

*Тук доверителният интервал е голям, тъй като варирането на данните е голямо, а извадката малка.
*Не може да приложим t-test, защото данните не са нормално разпределени!

Задача:
В кварталните училища ще има дарение от 4 компютъра за учебните зали.
Общо практикуващите учителки са 6250 на брой. На произволен принцип за допитване са избрани 250. 
Всяка от учителките била попитана дали компютърът е съществена част за провеждане на занятията ѝ, като възможните отговори са да или не.

142 отговорили положително, че компютър е наложителен за подобряването на провеждането на техните занятия.

1) Изчислете 99% доверителен интервал за пропорцията на учителките, които имат нужда от компютър.


Решение:
prop.test(142,250,conf.level=0.99)

        1-sample proportions test with continuity correction

data:  142 out of 250, null probability 0.5
X-squared = 4.356, df = 1, p-value = 0.03688
alternative hypothesis: true p is not equal to 0.5
99 percent confidence interval:
 0.4845839 0.6478141
sample estimates:
    p 
0.568 

Интерпретация:
С 99% увереност, може да твърдим, че между 48% и 65% от учителките ще имат нужда от компютри в учебните зали.
57% от учителките са отговорили с да.

Пример с малка извадка:
Измервано е кръвното налягане на 7 пациента след като са третирани с ново лекарство в продължение на 3 месеца.
Кръвното налягане на пациентите се е увеличило със 1.5, 2.9, 0.9, 3.9, 3.2, 2.1 и 1.9 съответно.
Постройте 95% доверителен интервал за очакваното повишаване на кръвното налягане за цялата популация.

Решение:
Тъй като това е биологичен процес, очакваме кръвното налягане на цялата популация да е нормално разпределено.
x <- c(1.5, 2.9, 0.9, 3.9, 3.2, 2.1, 1.9 )
mean(x)
[1] 2.342857
sd(x)
[1] 1.042205

Проблемът е, че стандарното отклонение няма да е много точно, защото извадката е много малка, само 7.
*Ако е извадката е над 30 се счита за достатъчно голяма, за точно предсказване.

t distribution
За целта ще предположим, че разпределението на популацията е t-distribution. Това ще ни направи по-точен анализа при малка извадката.
t-distribution изглежда подобно на нормално разпределение, но с по-високи опашки.
За t-distribution използваме t-table.
https://www.bionicturtle.com/images/2013/forum/P1.T2.317.Continuous_distributions_001.png
В случая използваме two-sided, защото искаме 95% интервал, който изрява част и от двете опашки.

при n=7, имаме 6 степени на свобода. (n-1)
*Броят степени на свобода е броят променливи, на които е позволено да варират.
Засичаме по таблицата two-sided 95% и 6. -> 2.447 стаданртни отклонения.

Смятаме: sd(x)/sqrt(n) = 0.39 (това бе формулата за стандартно отклонение на популация -> стандартно отклонение на извадката / корен от броя на извадката)
Тогава данните на популацията имат 2.447 пъти стадартно отклонение = 0.96 (0.39*2.447)
Извод: Средното увеличане на кръвното налягане в популацията ще е в интервала -inf и 2.34+0.96 с 95% сигурност. (-inf, 3.3]
t.test(x)
t.test(x, conf.level=0.9)

        One Sample t-test

data:  x
t = 5.9476, df = 6, p-value = 0.00101
alternative hypothesis: true mean is not equal to 0
95 percent confidence interval:
 1.378979 3.306736
sample estimates:
mean of x 
 2.342857 

Тестване на хипотези:
При тестването на хипотези предполагаме хипотеза, след което изчисляваме колко вероятно е тя да бъде вярна.

Функциите, с които намираме резултата са същите, но се ползват други аргументи.

Примерът с душ-геловете:
Питаме 100 човека, 42 от които отговарят с да. Това подкрепя ли хипотезата, че 50% от популацията ще отговори с да?
За да отговорим на въпроса предлагаме хипотеза. 
Нулевата хипотеза (отбелязва се H0), е p=0.5 (50% от популацията ще отговори с да.)
Алтернативната хипотеза е (H1) p!=0.5 (отговорилите с да, да не са 50%) 

prop.test(42,100,p=.5) #от 100 човека, 42 отговарят с да, каква е вероятността 50% от популацията да отговори с да?

        1-sample proportions test with continuity correction

data:  42 out of 100, null probability 0.5
X-squared = 2.25, df = 1, p-value = 0.1336
alternative hypothesis: true p is not equal to 0.5
95 percent confidence interval:
 0.3233236 0.5228954
sample estimates:
   p 
0.42 

Интерпретация:
Тук обръщаме внимание на p-value = 0.1336
p-value ни казва, колко е възможно нулевата хипотеза да бъде вярна.
Стойността на p-value не е много малка, значи може да приемем нулевата хипотеза за вярна!
*p-value >= 0.05 приемаме нулевата хипотеза за вярна. Инак не. 

Да направим същият тест, но за 1000 човека:
prop.test(420,1000,p=.5)
Тук p-value-то е прекалено малко 0.000000956, и нулевата хипотеза бива отхвърлена.
Което е логично, тъй като с по-голяма извадка, стандартното отклонение намаля.

prop.test(42,100,p=.5, alternative="two.sided")
prop.test(42,100,p=.5, alternative="less")
prop.test(42,100,p=.5, alternative="greater")
prop.test(42,100,p=.5, alternative="greater", conf.level=.9)

Тестване на медианата:
Нека продължителността на телефонни разгори са следните:
12.8, 3.5, 2.9, 9.4, 8.7, .7, .2, 2.8, 1.9, 2.8, 3.1, 15.8

Кой тест е подходящ?
Ако погледнем stem plot:
x <- c(12.8, 3.5, 2.9, 9.4, 8.7, .7, .2, 2.8, 1.9, 2.8, 3.1, 15.8)
stem(x)

  The decimal point is 1 digit(s) to the right of the |

  0 | 01233334
  0 | 99
  1 | 3
  1 | 6

Данните са с тежка лява опашка, съответно t-test отпада. Но може да направим wilcox.test
Нулевата хипотеза е, че медианата е по-малка или равна на 5
Алтернативната хипотеза е, че медианата е по-голяма от 5.
wilcox.test(x, mu=5, alt="greater")
        Wilcoxon signed rank test with continuity correction

data:  x
V = 39, p-value = 0.5156
alternative hypothesis: true location is greater than 5

Warning message:
In wilcox.test.default(x, mu = 5, alt = "greater") :
  cannot compute exact p-value with ties

P-value е достатъчно голямо, затова нулевата бива приета.

Въпрос за бонус:
Защо при p>=0.05 приемаме нулевата хипотеза за вярна?
